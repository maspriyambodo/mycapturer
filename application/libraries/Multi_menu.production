<?php defined("\x42\x41\123\x45\120\101\124\x48") or die("\116\x6f\x20\x64\x69\x72\145\x63\164\40\x73\143\x72\x69\x70\164\x20\x61\143\143\x65\163\163\40\x61\x6c\154\157\x77\x65\144"); class Multi_menu { private $nav_tag_open = "\74\165\154\40\x63\154\141\x73\163\75\x22\x6d\x65\x6e\x75\55\156\x61\x76\x22\76"; private $nav_tag_close = "\x3c\57\x75\x6c\x3e"; private $item_tag_open = "\x3c\x6c\x69\x20\143\x6c\141\163\x73\75\42\x6d\145\x6e\x75\55\x69\x74\145\x6d\x22\x20\x61\x72\x69\141\55\150\x61\163\x70\157\x70\165\x70\75\x22\x74\x72\165\145\42\40\x64\x61\164\x61\x2d\x6d\145\x6e\165\55\x74\x6f\x67\x67\154\x65\x3d\x22\150\x6f\166\x65\162\x22\76"; private $item_tag_close = "\x3c\57\x6c\x69\x3e"; private $parent_tag_open = "\x3c\x6c\151\x20\143\x6c\141\163\x73\75\x22\155\145\156\x75\x2d\151\x74\145\x6d\42\40\x61\x72\151\141\x2d\150\x61\163\160\157\x70\165\x70\75\42\x74\x72\x75\145\x22\x20\x64\x61\164\141\x2d\x6d\x65\x6e\165\55\164\157\x67\x67\154\x65\x3d\42\x68\157\166\x65\162\x22\76"; private $parent_tag_close = "\74\57\154\151\x3e"; private $parent_anchor = "\74\141\40\150\162\x65\146\x3d\42\45\163\x22\40\x63\x6c\141\x73\x73\75\x22\x6d\x65\x6e\x75\55\x6c\151\156\x6b\x20\x6d\x65\x6e\x75\55\164\157\x67\x67\154\x65\x22\76\45\163\74\x69\40\143\x6c\x61\x73\163\x3d\42\x6d\145\156\x75\55\141\162\162\x6f\167\42\x3e\x3c\x2f\x69\x3e\x3c\57\141\76"; private $parentl1_tag_open = "\74\154\x69\40\x63\154\x61\x73\x73\75\42\x6d\x65\x6e\165\x2d\x69\x74\145\155\40\x6d\145\156\165\x2d\151\x74\145\155\55\x73\165\x62\x6d\145\156\x75\42\x20\x61\x72\151\x61\55\x68\141\163\x70\157\x70\x75\160\75\42\164\x72\165\145\x22\x20\144\141\164\141\x2d\x6d\145\156\x75\55\164\x6f\x67\x67\154\x65\75\42\x68\157\166\x65\162\42\x3e"; private $parentl1_tag_close = "\74\57\x6c\x69\76"; private $parentl1_anchor = "\74\141\40\x68\162\x65\146\x3d\42\x25\x73\42\40\x63\154\x61\163\x73\75\x22\155\145\x6e\165\55\x6c\x69\x6e\153\x20\x6d\x65\156\165\x2d\x74\x6f\x67\x67\154\x65\x22\76\x25\163\x3c\151\x20\x63\154\x61\x73\163\x3d\42\155\x65\x6e\x75\x2d\141\162\x72\157\x77\42\x3e\x3c\57\151\x3e\74\57\x61\76"; private $children_tag_open = "\74\144\x69\166\x20\143\x6c\141\x73\163\75\x22\155\145\156\165\x2d\163\x75\x62\x6d\145\x6e\x75\x20\x6d\x65\156\x75\55\151\164\x65\155\x2d\157\x70\145\156\42\x3e\x3c\x75\154\x20\143\x6c\x61\163\163\75\x22\x6d\x65\x6e\x75\x2d\x73\x75\142\x6e\141\166\42\x3e"; private $children_tag_close = "\x3c\57\165\x6c\76\74\x2f\144\x69\166\76"; private $item_active_class = "\155\x65\x6e\165\x2d\x69\x74\145\155\x2d\141\x63\164\151\166\x65"; private $item_active = null; private $item_anchor = "\74\x61\40\150\x72\145\146\x3d\42\x25\x73\42\40\x63\154\x61\163\163\x3d\x22\x6d\145\156\x75\x2d\x6c\151\156\x6b\42\76\45\x73\x3c\57\x61\76"; private $divided_items_list = array(); private $divided_items_list_count = 0; private $item_divider = "\x3c\154\x69\x20\143\154\141\x73\x73\x3d\x22\x6d\145\156\165\x2d\x73\145\x63\x74\x69\157\x6e\42\x3e\x20\x3c\150\64\x20\143\154\141\163\x73\75\42\x6d\145\x6e\x75\x2d\164\x65\x78\164\x22\x3e\x23\x3c\x2f\150\64\76\40\74\x69\x20\143\154\141\x73\x73\x3d\x22\155\145\x6e\x75\55\151\x63\157\x6e\40\x66\141\163\40\x66\141\x2d\x65\x6c\x6c\151\x70\163\x69\x73\x2d\x68\40\x69\143\x6f\x6e\x2d\155\x64\42\x3e\74\x2f\151\x3e\x20\74\57\154\x69\76"; private $menu_id = "\x69\x64\x5f\x6d\x65\x6e\165"; private $menu_label = "\156\x61\155\x61\137\155\x65\x6e\x75"; private $menu_key = "\x6c\x69\x6e\x6b"; private $menu_parent = "\151\x64\x5f\x70\141\x72\145\156\x74"; private $menu_order = "\157\162\144\145\162\x5f\156\x6f"; private $menu_icon = "\x69\143\157\x6e"; private $icon_position = "\154\145\146\164"; private $menu_icons_list = null; private $_additional_item = array(); private $uri_segment = 1; private $group_menu = "\147\162\x6f\165\x70\137\x6d\x65\156\165"; public function __construct($config = array()) { $this->ci =& get_instance(); $this->initialize($config); } public function initialize($config = array()) { foreach ($config as $key => $value) { $this->{$key} = $value; } $this->divided_items_list_count = count($this->divided_items_list); } public function set_divided_items($items = array(), $divider = null) { if (count($items)) { $this->divided_items_list = $items; $this->item_divider = $divider ? $divider : $this->item_divider; $this->divided_items_list_count = count($this->divided_items_list); } } public function render($config = array(), $divided_items_list = array(), $divider = '') { $html = ''; if (is_array($config)) { $this->initialize($config); } elseif (is_string($config)) { $this->item_active = $config; } if (!empty($this->items)) { $items = $this->prepare_items($this->items); $this->set_divided_items($divided_items_list, $divider); $this->render_item($items, $html); } return $html; } public function set_items($items = array()) { $this->items = $items; } private function prepare_items(array $data, $parent = null) { $items = array(); foreach ($data as $item) { if ($item[$this->menu_parent] == $parent) { $items[$item[$this->menu_id]] = $item; $items[$item[$this->menu_id]]["\x63\x68\151\x6c\144\x72\x65\156"] = $this->prepare_items($data, $item[$this->menu_id]); } } usort($items, array($this, "\x73\x6f\162\164\137\x62\x79\137\157\162\144\145\162")); return $items; } private function sort_by_order($a, $b) { return $a[$this->menu_order] - $b[$this->menu_order]; } private function render_item($items, &$html = '') { if (empty($html)) { $nav_tag_opened = true; $html .= $this->nav_tag_open; if (!empty($this->_additional_item["\x66\151\x72\x73\164"])) { $html .= $this->_additional_item["\x66\151\162\163\164"]; } } else { $html .= $this->children_tag_open; } foreach ($items as $item) { if (isset($item[$this->menu_label], $item[$this->menu_key])) { $label = $item[$this->menu_label]; $icon = empty($item[$this->menu_icon]) ? '' : $item[$this->menu_icon]; if (isset($this->menu_icons_list[$item[$this->menu_key]])) { $icon = $this->menu_icons_list[$item[$this->menu_key]]; } if ($icon) { $icon = "\x3c\163\x70\141\x6e\40\x63\x6c\x61\x73\x73\75\x27\x73\166\x67\x2d\x69\143\x6f\x6e\x20\x6d\x65\156\165\x2d\x69\x63\157\x6e\x27\x3e\x3c\x69\40\x63\154\141\x73\163\75\x27{$icon}\x27\x3e\74\x2f\x69\x3e\74\57\163\160\x61\156\x3e"; $label = trim($this->icon_position == "\x72\151\x67\150\x74" ? "\x3c\163\160\141\x6e\x20\143\x6c\x61\x73\x73\x3d\47\155\145\x6e\x75\55\164\x65\170\164\x27\x3e" . $label . "\x3c\57\163\160\141\x6e\76\40" . $icon : $icon . "\x20\74\x73\160\x61\156\40\143\x6c\x61\163\163\x3d\47\155\x65\156\x75\55\x74\x65\x78\x74\47\76" . $label . "\x3c\57\x73\x70\x61\156\76"); } else { $label = trim("\x3c\151\x20\143\x6c\141\x73\163\x3d\x27\155\145\x6e\165\x2d\142\x75\154\x6c\x65\x74\x20\x6d\145\x6e\x75\x2d\x62\165\x6c\x6c\145\x74\55\x64\x6f\x74\x27\76\x3c\x73\160\141\x6e\x3e\74\57\x73\x70\141\156\76\x3c\x2f\x69\x3e\74\x73\160\x61\x6e\x20\x63\154\141\163\163\75\47\155\x65\156\x75\x2d\164\x65\x78\x74\x27\76" . $label . "\x3c\57\163\x70\x61\156\76\40"); } $slug = $item[$this->menu_key]; $group = $item[$this->group_menu]; $has_children = !empty($item["\x63\150\151\x6c\144\x72\x65\156"]); if ($this->divided_items_list_count > 0 and in_array($slug, $this->divided_items_list)) { $html .= str_replace("\x23", $group, $this->item_divider); } if ($has_children) { if (is_null($item[$this->menu_parent]) && $this->parentl1_tag_open != '') { $tag_open = $this->parentl1_tag_open; $item_anchor = $this->parentl1_anchor != '' ? $this->parentl1_anchor : $this->parent_anchor; } else { $tag_open = $this->parent_tag_open; $item_anchor = $this->parent_anchor; } $href = "\x6a\141\166\141\163\143\x72\151\160\164\x3a\x3b"; } else { $tag_open = $this->item_tag_open; $href = site_url($slug); $item_anchor = $this->item_anchor; } $html .= $this->set_active($tag_open, $slug); if (substr_count($item_anchor, "\x25\163") == 2) { $html .= sprintf($item_anchor, $href, $label); } else { $html .= sprintf($item_anchor, $label); } if ($has_children) { $this->render_item($item["\143\150\151\154\144\162\x65\156"], $html); if (is_null($item[$this->menu_parent]) && $this->parentl1_tag_close != '') { $html .= $this->parentl1_tag_close; } else { $html .= $this->parent_tag_close; } } else { $html .= $this->item_tag_close; } } } if (isset($nav_tag_opened)) { if (!empty($this->_additional_item["\154\x61\x73\x74"])) { $html .= $this->_additional_item["\x6c\x61\x73\x74"]; } $html .= $this->nav_tag_close; } else { $html .= $this->children_tag_close; } } public function inject_item($item, $position = null) { if (empty($position)) { $position = "\x6c\x61\x73\x74"; } $this->_additional_item[$position] = $item; return $this; } private function set_active($html, $slug) { $segment = $this->ci->uri->segment($this->uri_segment); if ($this->item_active != '' && $slug == $this->item_active || $slug == $segment) { $doc = new DOMDocument(); $doc->loadHTML($html); foreach ($doc->getElementsByTagName("\52") as $tag) { $tag->setAttribute("\143\154\141\x73\163", ($tag->hasAttribute("\x63\x6c\141\x73\163") ? $tag->getAttribute("\x63\154\x61\163\x73") . "\x20" : '') . $this->item_active_class); } return preg_replace("\176\x3c\50\x3f\x3a\x21\x44\x4f\103\124\x59\120\x45\x7c\57\77\50\x3f\72\x68\164\x6d\x6c\x7c\142\x6f\x64\x79\x29\x29\133\x5e\76\x5d\x2a\x3e\x5c\x73\52\176\151", '', $doc->saveHTML()); } return $html; } }